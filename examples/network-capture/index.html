<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReplayDash - Network Capture Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 18px;
      opacity: 0.9;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    .card h2 {
      margin-bottom: 20px;
      color: #333;
      font-size: 24px;
    }

    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    button {
      padding: 15px 25px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-error {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .btn-error:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
    }

    .btn-slow {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .btn-slow:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
    }

    .log {
      background: #f7f7f7;
      border-radius: 10px;
      padding: 20px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      max-height: 300px;
      overflow-y: auto;
      color: #333;
    }

    .log-entry {
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 5px;
    }

    .log-success {
      background: #d4edda;
      color: #155724;
    }

    .log-error {
      background: #f8d7da;
      color: #721c24;
    }

    .log-info {
      background: #d1ecf1;
      color: #0c5460;
    }

    .status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 12px;
      margin-right: 8px;
    }

    .status-success {
      background: #28a745;
      color: white;
    }

    .status-error {
      background: #dc3545;
      color: white;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .info {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      color: #0c5460;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üåê ReplayDash</h1>
      <p>Network Capture Demo</p>
    </div>

    <div class="card">
      <h2>Test Network Requests</h2>
      <p style="margin-bottom: 20px; color: #666;">
        Click the buttons below to trigger different types of network requests. 
        All requests will be captured by ReplayDash and visible in the dashboard.
      </p>

      <div class="button-group">
        <button class="btn-success" onclick="makeSuccessfulRequest()">
          ‚úÖ Successful GET
        </button>
        <button class="btn-success" onclick="makePostRequest()">
          üì§ POST with Data
        </button>
        <button class="btn-error" onclick="make404Request()">
          üö´ 404 Not Found
        </button>
        <button class="btn-error" onclick="make500Request()">
          ‚ö†Ô∏è 500 Server Error
        </button>
        <button class="btn-error" onclick="makeFailedRequest()">
          üí• Network Error
        </button>
        <button class="btn-slow" onclick="makeSlowRequest()">
          üêå Slow Request (3s)
        </button>
      </div>

      <div class="info">
        <strong>üí° Tip:</strong> Open the ReplayDash dashboard to see these requests in real-time!
      </div>
    </div>

    <div class="card">
      <h2>Submit Form (POST Request)</h2>
      <form id="userForm" onsubmit="submitForm(event)">
        <div class="form-group">
          <label for="name">Name:</label>
          <input type="text" id="name" name="name" placeholder="John Doe" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" placeholder="john@example.com" required>
        </div>
        <button type="submit" class="btn-success" style="width: 100%;">
          Submit Form
        </button>
      </form>
    </div>

    <div class="card">
      <h2>Request Log</h2>
      <div id="log" class="log">
        <div class="log-entry log-info">
          üìù Waiting for requests... Click a button above to test network capture.
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Session Info</h2>
      <div style="background: #f7f7f7; padding: 15px; border-radius: 10px; font-family: monospace;">
        <div><strong>Session ID:</strong> <span id="sessionId">Loading...</span></div>
        <div style="margin-top: 10px;"><strong>ReplayDash Status:</strong> <span id="status">Initializing...</span></div>
      </div>
    </div>
  </div>

  <!-- ReplayDash SDK -->
  <script src="../../packages/sdk/dist/index.js"></script>
  
  <script>
    // Initialize ReplayDash with network capture
    try {
      window.ReplayDash.replayDash.init({
        apiKey: 'demo-api-key',
        endpoint: 'http://localhost:3001', // Update to your API endpoint
        captureConsole: true,
        captureNetwork: true, // Enable network capture
        networkConfig: {
          // Ignore certain URLs (example)
          ignoreUrls: [
            /\.(png|jpg|jpeg|gif|svg|ico)$/,
            'google-analytics.com',
          ],
          
          // Sanitize sensitive headers
          sanitizeHeaders: true,
          sensitiveHeaders: [
            'authorization',
            'x-api-key',
            'cookie',
          ],
          
          // Limit body size
          maxBodyLength: 10000,
          
          // Capture request/response bodies
          captureRequestBody: true,
          captureResponseBody: true,
        },
      });

      // Display session ID
      const sessionId = window.ReplayDash.replayDash.getSessionId();
      document.getElementById('sessionId').textContent = sessionId || 'Unknown';
      document.getElementById('status').textContent = '‚úÖ Active';
      document.getElementById('status').style.color = '#28a745';

      console.log('ReplayDash initialized with session ID:', sessionId);
    } catch (error) {
      console.error('Failed to initialize ReplayDash:', error);
      document.getElementById('status').textContent = '‚ùå Error';
      document.getElementById('status').style.color = '#dc3545';
    }

    // Logging helper
    function addLog(message, type = 'info') {
      const log = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = message;
      log.insertBefore(entry, log.firstChild);
    }

    // API Base URL (JSONPlaceholder for testing)
    const API_BASE = 'https://jsonplaceholder.typicode.com';

    // Test functions
    async function makeSuccessfulRequest() {
      addLog('üîÑ Making GET request to /posts/1...', 'info');
      try {
        const response = await fetch(`${API_BASE}/posts/1`);
        const data = await response.json();
        addLog(`‚úÖ [${response.status}] GET /posts/1 - Success! Title: ${data.title}`, 'success');
      } catch (error) {
        addLog(`‚ùå GET /posts/1 - Error: ${error.message}`, 'error');
      }
    }

    async function makePostRequest() {
      addLog('üîÑ Making POST request with data...', 'info');
      const postData = {
        title: 'ReplayDash Test',
        body: 'Testing network capture with POST request',
        userId: 1,
      };
      
      try {
        const response = await fetch(`${API_BASE}/posts`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer secret-token-12345', // Will be sanitized
          },
          body: JSON.stringify(postData),
        });
        const data = await response.json();
        addLog(`‚úÖ [${response.status}] POST /posts - Created with ID: ${data.id}`, 'success');
      } catch (error) {
        addLog(`‚ùå POST /posts - Error: ${error.message}`, 'error');
      }
    }

    async function make404Request() {
      addLog('üîÑ Making request to non-existent resource...', 'info');
      try {
        const response = await fetch(`${API_BASE}/posts/99999`);
        addLog(`üö´ [${response.status}] GET /posts/99999 - Not Found`, 'error');
      } catch (error) {
        addLog(`‚ùå GET /posts/99999 - Error: ${error.message}`, 'error');
      }
    }

    async function make500Request() {
      addLog('üîÑ Simulating server error...', 'info');
      // JSONPlaceholder doesn't have 500 errors, so we'll use a non-existent endpoint
      try {
        const response = await fetch('https://httpstat.us/500');
        addLog(`‚ö†Ô∏è [${response.status}] Server Error - ${response.statusText}`, 'error');
      } catch (error) {
        addLog(`‚ùå Server Error - ${error.message}`, 'error');
      }
    }

    async function makeFailedRequest() {
      addLog('üîÑ Making request to invalid domain...', 'info');
      try {
        const response = await fetch('https://this-domain-does-not-exist-12345.com/api');
        addLog(`‚úÖ [${response.status}] Unexpected success?`, 'success');
      } catch (error) {
        addLog(`üí• Network Error - ${error.message}`, 'error');
      }
    }

    async function makeSlowRequest() {
      addLog('üîÑ Making slow request (3 seconds)...', 'info');
      const startTime = Date.now();
      try {
        const response = await fetch('https://httpbin.org/delay/3');
        const duration = Date.now() - startTime;
        addLog(`üêå [${response.status}] Slow request completed in ${duration}ms`, 'success');
      } catch (error) {
        addLog(`‚ùå Slow request failed - ${error.message}`, 'error');
      }
    }

    async function submitForm(event) {
      event.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;

      addLog(`üîÑ Submitting form data for ${name}...`, 'info');

      try {
        const response = await fetch(`${API_BASE}/users`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ name, email }),
        });
        
        const data = await response.json();
        addLog(`‚úÖ [${response.status}] Form submitted! User ID: ${data.id}`, 'success');
        document.getElementById('userForm').reset();
      } catch (error) {
        addLog(`‚ùå Form submission failed - ${error.message}`, 'error');
      }
    }

    // Automatically test a few requests on load
    setTimeout(() => {
      console.log('Running automatic test requests...');
      makeSuccessfulRequest();
    }, 1000);
  </script>
</body>
</html>
